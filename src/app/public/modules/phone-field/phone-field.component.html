<ng-container *ngIf="!inputBoxHostSvc">
  <div
    class="sky-input-group sky-phone-field"
    [@blockAnimationOnLoad]
  >
    <ng-container *ngTemplateOutlet="countryBtnTemplateRef"></ng-container>
    <ng-container *ngTemplateOutlet="inputTemplateRef"></ng-container>
  </div>
</ng-container>

<ng-template
  #countryBtnTemplateRef
>
  <div
    class="sky-input-group-btn sky-phone-field-country-btn"
  >
    <button
      aria-live="polite"
      class="sky-btn sky-btn-default"
      type="button"
      [attr.title]="('skyux_phone_field_country_select_label' | skyLibResources) + ' ' + ('skyux_phone_field_country_selected_label' | skyLibResources:selectedCountry?.name)"
      [attr.aria-label]="('skyux_phone_field_country_select_label' | skyLibResources) + ' ' + ('skyux_phone_field_country_selected_label' | skyLibResources:selectedCountry?.name)"
      [disabled]="countrySelectDisabled"
      (click)="toggleCountrySearch(true)"
      >
      <div
        class="sky-phone-field-flag iti-flag"
        [ngClass]="selectedCountry?.iso2"
      >
      </div>
    </button>
  </div>
</ng-template>

<ng-template
  #inputTemplateRef
>
  <span *ngIf="phoneInputShown"
    class="sky-phone-field-container"
    [@phoneInputAnimation]="phoneInputShown ? 'open' : 'closed'"
    (@phoneInputAnimation.done)="phoneInputAnimationEnd($event)"
  >
    <ng-content></ng-content>
  </span>
  <span *ngIf="countrySearchShown"
    class="sky-phone-field-container"
    [@countrySearchAnimation]="countrySearchShown ? 'open' : 'closed'"
    (@countrySearchAnimation.done)="countrySearchAnimationEnd($event)"
  >
    <div
      class="sky-phone-field-country-search"
      [formGroup]="countrySearchForm"
    >
      <sky-country-field
        formControlName="countrySearch"
        [defaultCountry]="defaultCountry"
        [hideSelectedCountryFlag]="true"
        [includePhoneInfo]="true"
        (selectedCountryChange)="onCountrySelected($event)"
      >
      </sky-country-field>
    </div>
    <div
      class="sky-search-item-dismiss"
    >
      <button
        class="sky-btn sky-phone-field-search-btn-dismiss"
        type="button"
        [attr.title]="'skyux_phone_field_country_search_dismiss' | skyLibResources"
        [ngClass]="{
          'sky-btn-default':
            (themeSvc?.settingsChange | async)?.currentSettings?.theme?.name === 'modern'
        }"
        (click)="toggleCountrySearch(false)"
      >
        <sky-icon
          class="sky-phone-field-search-close-icon-default"
          icon="chevron-circle-left"
          size="lg"
        >
        </sky-icon>
        <sky-icon
          class="sky-phone-field-search-close-icon-modern"
          icon="close"
          iconType="skyux"
          size="2x"
        >
        </sky-icon>
      </button>
    </div>
  </span>
</ng-template>

<ng-template
  let-item="item"
  #countrySearchResultTemplate
>
  <div
    class="sky-phone-field-search-result"
  >
    <i
      aria-hidden="true"
      [className]="'sky-phone-field-flag iti-flag ' + item.iso2"
    ></i>
    {{ item.name }}
    <span
      class="sky-deemphasized"
    >{{ item.dialCode }}</span>
  </div>
</ng-template>
